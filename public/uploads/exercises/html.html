<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Exercises</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0f1115;
        --card: #151821;
        --muted: #9aa3b2;
        --text: #eef2f7;
        --accent: #60a5fa;
        --chip: #222738;
        --ok: #34d399;
        --warn: #f59e0b;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Ubuntu,
          'Helvetica Neue',
          Arial,
          sans-serif;
        background: linear-gradient(180deg, #0b0d12, #0f1115);
        color: var(--text);
      }
      .container {
        max-width: 1100px;
        margin: 32px auto;
        padding: 0 16px;
      }
      header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 12px;
        justify-content: space-between;
        margin-bottom: 16px;
      }
      h1 {
        font-size: 28px;
        margin: 0;
      }
      .tools {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      input[type='search'],
      select {
        background: #0e121a;
        border: 1px solid #22283a;
        color: var(--text);
        border-radius: 12px;
        padding: 10px 12px;
        outline: none;
        min-width: 220px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
      }
      .card {
        background: var(--card);
        border: 1px solid #22283a;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.35);
        display: flex;
        flex-direction: column;
      }
      .thumb {
        position: relative;
        background: #0e121a;
        aspect-ratio: 16/10;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .thumb img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.5));
      }
      .badge {
        position: absolute;
        left: 10px;
        top: 10px;
        background: var(--chip);
        border: 1px solid #2a3146;
        color: var(--muted);
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
      }
      .body {
        padding: 14px 14px 8px;
      }
      .title {
        font-weight: 700;
        font-size: 16px;
        line-height: 1.2;
        margin: 0 0 6px;
      }
      .details {
        color: var(--muted);
        font-size: 13px;
        line-height: 1.4;
        margin: 0 0 10px;
      }
      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin: 6px 0 10px;
      }
      .chip {
        background: var(--chip);
        border: 1px solid #2a3146;
        color: #b7c0d1;
        padding: 5px 8px;
        border-radius: 10px;
        font-size: 12px;
      }
      .kv {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 6px;
      }
      .kv div {
        background: #0e121a;
        border: 1px solid #22283a;
        border-radius: 10px;
        padding: 6px 8px;
        text-align: center;
      }
      .kv small {
        display: block;
        color: var(--muted);
        font-size: 11px;
      }
      .actions {
        display: flex;
        gap: 8px;
        padding: 12px 14px 14px;
        margin-top: auto;
      }
      button {
        appearance: none;
        border: 1px solid #264c7d;
        background: #102033;
        color: #cfe3ff;
        border-radius: 12px;
        padding: 8px 12px;
        font-weight: 600;
        cursor: pointer;
      }
      button.secondary {
        background: #131722;
        border-color: #2a3146;
        color: #c9d3e6;
      }
      .empty {
        opacity: 0.75;
        padding: 20px;
        text-align: center;
        border: 1px dashed #2a3146;
        border-radius: 16px;
      }
      /* Modal */
      .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
        z-index: 50;
      }
      .modal.open {
        display: flex;
      }
      .modal-content {
        background: #0b0f16;
        border: 1px solid #243048;
        border-radius: 16px;
        max-width: 960px;
        width: 100%;
        padding: 12px;
      }
      .modal header {
        justify-content: space-between;
        margin: 0 0 8px;
      }
      .modal video {
        width: 100%;
        max-height: 75vh;
        background: #000;
        border-radius: 12px;
      }
      .pill {
        padding: 4px 8px;
        border: 1px solid #2a3146;
        border-radius: 999px;
        color: #bcd1ff;
        font-size: 12px;
      }
      .footer {
        margin-top: 22px;
        color: var(--muted);
        font-size: 12px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Exercise Library</h1>
        <div class="tools">
          <input id="search" type="search" placeholder="Search name, details, muscle…" />
          <select id="category">
            <option value="">All categories</option>
          </select>
          <span class="pill" id="count">0 items</span>
        </div>
      </header>

      <div id="grid" class="grid"></div>
      <div id="empty" class="empty" style="display: none">No exercises matched your filters.</div>

      <div class="footer">Tip: Click “Play Video” to preview; add more objects to the <code>exercises</code> array below.</div>
    </div>

    <!-- Simple video modal -->
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-content">
        <header>
          <strong id="modalTitle">Preview</strong>
          <div class="tools">
            <button id="closeModal">Close</button>
          </div>
        </header>
        <video id="modalVideo" controls></video>
      </div>
    </div>

    <script>
      // ===== 1) Your data goes here. Add as many objects as you like. =====
      let exercises = [];

      async function loadExercises() {
        try {
          const res = await fetch('exercise.json');
          exercises = await res.json(); 
          render(); // call your render function from earlier
        } catch (err) {
          console.error('Failed to load exercises.json', err);
          document.getElementById('grid').innerHTML = "<div class='empty'>⚠️ Could not load exercises.json</div>";
        }
      }

      loadExercises();

      // ===== 2) Utilities =====
      const $ = sel => document.querySelector(sel);

      function uniqueCategories(list) {
        return Array.from(new Set(list.map(x => x.category).filter(Boolean))).sort();
      }

      function textIncludes(hay, needle) {
        return hay.toLowerCase().includes(needle.toLowerCase());
      }

      function exerciseMatches(ex, q) {
        if (!q) return true;
        const fields = [ex.name, ex.details, ex.category, ...(ex.primary_muscles_worked || []), ...(ex.secondary_muscles_worked || [])].filter(Boolean).join(' | ');
        return textIncludes(fields, q);
      }

      // ===== 3) Renderers =====
      function chip(text) {
        return `<span class="chip">${text}</span>`;
      }

      function renderCard(ex) {
        const prim = (ex.primary_muscles_worked || []).map(chip).join('');
        const sec = (ex.secondary_muscles_worked || []).map(chip).join('');
        const hasImg = !!ex.img;
        const hasVideo = !!ex.video;

        return `
        <article class="card">
          <div class="thumb">
            ${!ex.img 
						? `<video src="${ex.video}" alt="${ex.name} image" onerror="this.src='data:image/svg+xml;utf8,${encodeURIComponent(placeholderSVG())}'" />` 
						: `<img alt="" src="${"../../" + ex.img}" />
						`}
            <span class="badge">${ex.category || 'Uncategorized'}</span>
          </div>
          <div class="body">
            <h2 class="title">${ex.name}</h2>
            <p class="details">${ex.details || ''}</p>

            ${prim ? `<div class="chips" title="Primary muscles">${prim}</div>` : ''}
            ${sec ? `<div class="chips" title="Secondary muscles">${sec}</div>` : ''}

            <div class="kv" aria-label="Targets">
              <div><small>Sets</small><strong>${ex.targetSets ?? '-'}</strong></div>
              <div><small>Reps</small><strong>${ex.targetReps ?? '-'}</strong></div>
              <div><small>Rest</small><strong>${ex.rest ?? '-'}s</strong></div>
              <div><small>Tempo</small><strong>${ex.tempo ?? '-'}</strong></div>
            </div>
          </div>
          <div class="actions">
            ${hasVideo ? `<button onclick="openVideo('${encodeURIComponent(ex.video)}','${encodeURIComponent(ex.name)}')">▶ Play Video</button>` : `<button class="secondary" disabled>No Video</button>`}
            <button class="secondary" onclick='console.log(${JSON.stringify(ex)})'>Log JSON</button>
          </div>
        </article>
      `;
      }

      function placeholderSVG() {
        return `
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 375'>
          <defs>
            <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
              <stop offset='0%' stop-color='#121722'/>
              <stop offset='100%' stop-color='#0f141d'/>
            </linearGradient>
          </defs>
          <rect width='100%' height='100%' fill='url(#g)'/>
          <g fill='#31405c' font-family='Arial, Helvetica, sans-serif'>
            <rect x='170' y='90' width='260' height='180' rx='16' fill='#1b2333' stroke='#2a3b59'/>
            <text x='300' y='310' text-anchor='middle' font-size='18' fill='#7f8aa6'>No Image</text>
          </g>
        </svg>
      `;
      }

      function render() {
        const q = $('#search').value.trim();
        const cat = $('#category').value;
        const filtered = exercises 
        $('#count').textContent = `${filtered.length} item${filtered.length === 1 ? '' : 's'}`;

        const html = exercises.map(renderCard).join('');
        const grid = $('#grid');
        grid.innerHTML = html;

        $('#empty').style.display = filtered.length ? 'none' : 'block';
      }

      // ===== 4) Modal video handling =====
      function openVideo(encodedUrl, encodedTitle) {
        const url = decodeURIComponent(encodedUrl);
        const title = decodeURIComponent(encodedTitle);
        const modal = $('#modal');
        const vid = $('#modalVideo');
        $('#modalTitle').textContent = `Preview · ${title}`;
        vid.src = url;
        vid.currentTime = 0;
        modal.classList.add('open');
        vid.play().catch(() => {
          /* autoplay may be blocked */
        });
      }
      window.openVideo = openVideo;

      function closeModal() {
        const modal = $('#modal');
        const vid = $('#modalVideo');
        vid.pause();
        vid.removeAttribute('src');
        vid.load();
        modal.classList.remove('open');
      }

      // ===== 5) Init =====
      (function init() {
        // Populate category filter
        const cats = uniqueCategories(exercises);
        const sel = $('#category');
        cats.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c;
          opt.textContent = c;
          sel.appendChild(opt);
        });

        // Bind events
        $('#search').addEventListener('input', render);
        $('#category').addEventListener('change', render);
        $('#closeModal').addEventListener('click', closeModal);
        $('#modal').addEventListener('click', e => {
          if (e.target.id === 'modal') closeModal();
        });
        window.addEventListener('keydown', e => {
          if (e.key === 'Escape') closeModal();
        });

        render();
      })();
    </script>
  </body>
</html>
